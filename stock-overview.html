<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Overview</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css2?family=Cabin_Sketch:wght@400;700&display=swap" rel="stylesheet">
<style>
    body {
        font-family: 'Roboto', sans-serif;
		margin: 0;
		color: #fff;
		position: relative;
    }

	body::before {
		content: "";
		position: fixed;
		top: 0;
		left: 0;
		width: 100%;
		height: 100%;
		background: url('Background.png') no-repeat center center fixed;
		background-size: cover;
		filter: blur(2px);
		opacity: 1; /* Transparenz des Hintergrundbildes */
		z-index: -1; /* Stellt sicher, dass der Inhalt des Body darüber bleibt */
	}

	h1{
		font-family: 'Orbitron', sans-serif;
		font-weight: 700;
	}
	
    /* Header */
    .header {
    background-color: rgba(24, 39, 58, 0.8);
    background-image: url('header-background.jpg'); /* Pfad zum Bild */
    background-size: cover; /* Bild auf die Größe des Headers skalieren */
    background-blend-mode: overlay; /* Mischt das Bild mit der Hintergrundfarbe */
    padding: 40px;
    text-align: center;
    color: #fff;
	font-size: 2em;
	margin: 0;
	text-shadow: 
        1px 1px 0 #000,  /* Schatten rechts unten */
       -1px 1px 0 #000,  /* Schatten links unten */
        1px -1px 0 #000,  /* Schatten rechts oben */
       -1px -1px 0 #000;  /* Schatten links oben */
	}

    .header h1 {
        margin: 0;
        font-size: 4em;
    }

	.spacebar {
		width: 100%; 
		height: 3px;
		background-color: rgba(0, 0, 0, 0.5);
		background-image: url('header-background.jpg'); /* Pfad zum Bild */
		background-size: cover; /* Bild auf die Größe des Headers skalieren */
		background-blend-mode: overlay; /* Mischt das Bild mit der Hintergrundfarbe */
		margin: 0;
	}
   
   /* Navigation */
    .navbar {
        display: flex;
		background-color: rgba(152, 126, 77, 0.5);
		background-image: url('header-background.jpg'); /* Pfad zum Bild */
		background-size: cover; /* Bild auf die Größe des Headers skalieren */
		background-blend-mode: overlay; /* Mischt das Bild mit der Hintergrundfarbe */
        justify-content: center;
    }

    .navbar a {
        color: #18273a;
        padding: 14px 20px;
        text-decoration: none;
        font-weight: bold;
    }
	
	.navbar a.active {
		background-color: rgba(0, 0, 0, 0.4); /* Gleiche Farbe wie die Header-Fläche */
		color: white;
		text-shadow: 
        0.5px 0.5px 0 #000,  /* Schatten rechts unten */
       -0.5px 0.5px 0 #000,  /* Schatten links unten */
        0.5px -0.5px 0 #000,  /* Schatten rechts oben */
       -0.5px -0.5px 0 #000;  /* Schatten links oben */
	}

    .navbar a:hover {
        background-color: rgba(0, 0, 0, 0.2);
        color: white;
		text-shadow: 
        0.5px 0.5px 0 #000,  /* Schatten rechts unten */
       -0.5px 0.5px 0 #000,  /* Schatten links unten */
        0.5px -0.5px 0 #000,  /* Schatten rechts oben */
       -0.5px -0.5px 0 #000;  /* Schatten links oben */
    }

    /* Main content container */
    .container {
		position: relative;
        max-width: 1200px;
        margin: 40px auto;
        padding: 20px;
        border-radius:15px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 1);
        color: #fff;
		overflow: hidden;
    }
	
	.container::before {
		content: "";
		position: absolute;
		top: 0;
		left: 0;
		right: 0;
		bottom: 0;
		background-color: rgba(24, 39, 58, 0.8); /* Halbtransparente Hintergrundfarbe */
		background-image: url('header-background.jpg'); /* Bild hinzufügen */
		background-size: cover; /* Bild auf die Größe des Containers skalieren */
		background-blend-mode: overlay; /* Mischt das Bild mit der Hintergrundfarbe */
		opacity: 0.85; /* Transparenz des Hintergrundbildes */
		z-index: -1; /* Stellt sicher, dass das Bild hinter dem Inhalt bleibt */
	}

    /* Centered Dropdown Menu */
    .selection-group {
        display: flex;
        justify-content: center; /* Zentriert die Dropdowns horizontal */
        align-items: center;
        gap: 20px;
        margin-bottom: 20px;
        flex-wrap: nowrap;
    }

    .selection-group div {
        flex: 1;
        min-width: 200px;
        max-width: 250px; /* Beschränkt die Breite der Dropdowns */
    }

    .selection-group label {
        font-weight: bold;
        margin-right: 10px;
    }

    select {
        padding: 8px;
        border-radius: 4px;
        border: 1px solid #ddd;
        background-color: #333;
        color: #fff;
        width: 100%; /* Vollbreite des Containers */
    }

    /* Live Price Section */
    #live-price {
        margin-bottom: 40px;
        text-align: center;
        font-size: 1.2em;
    }

    /* Chart Section */
    #chart-container {
        text-align: center;
        margin-top: 40px;
		font-size: 1.5em;
    }

    #priceChart {
        max-width: 100%;
        margin: 20px auto;
        border-radius: 8px;
        padding: 10px;
		content: "";
		background-color: rgba(0, 0, 0, 0.5); /* Halbtransparente Hintergrundfarbe */
		background-image: url('diagramm-background.jpg'); /* Bild hinzufügen */
		background-size: cover; /* Bild auf die Größe des Containers skalieren */
		background-blend-mode: overlay; /* Mischt das Bild mit der Hintergrundfarbe */
		opacity: 0.85; /* Transparenz des Hintergrundbildes */
		z-index: -1; /* Stellt sicher, dass das Bild hinter dem Inhalt bleibt */
    }

    h2 {
        color: #fff;
    }

    /* Media Query für Mobilgeräte */
    @media (max-width: 768px) {
        .header h1 {
            font-size: 1.5em;
        }

        .navbar a {
            padding: 10px 15px;
            font-size: 0.9em;
        }

        .container {
            padding: 15px;
            margin: 10px;
        }

        .selection-group {
            flex-direction: column; /* Vertikale Ausrichtung für mobile Geräte */
            gap: 10px;
        }

        #live-price {
            font-size: 1em;
        }

        #priceChart {
            padding: 10px;
        }
    }
	
</style>


    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

    <!-- Header -->
    <div class="header">
        <h1>EverTrend</h1>
    </div>

	<div class="spacebar">
    </div>
	
    <!-- Navigation -->
    <div class="navbar">
        <a href="index.html">Home</a>
        <a href="stock-overview.html" class="active">Stock Overview</a>
        <a href="contact.html">Contact</a>
    </div>
	
	<div class="spacebar">
    </div>

    <!-- Hauptinhalt -->
    <div class="container">
        <div class="selection-group">
            <div>
                <label for="countrySelect">Country:</label>
                <select id="countrySelect" onchange="updateCompanyList()">
                    <option value="DE">Germany</option>
                    <option value="US">USA</option>
                    <option value="GB">Great Britain</option>
                    <option value="FR">France</option>
                </select>
            </div>
            <div>
                <label for="stockSelect">Company:</label>
                <select id="stockSelect" onchange="updateStockData()"></select>
            </div>
        </div>

        <div id="live-price">
            <h2>Current Course</h2>
            <p id="price">Loading...</p>
        </div>

        <div id="chart-container">
            <h2>Share Price Trend (100 Days)</h2>
            <canvas id="priceChart" width="900" height="500"></canvas>
        </div>
    </div>

	<script>
    const apiKey = 'GPBLOCO6FXONQBXS'; // Ersetze dies durch deinen Alpha Vantage API-Schlüssel
    const maxUpdatesPerDay = 20; // Maximale Aktualisierungen pro Tag
    const updateInterval = 60 * 60 * 1000; // Aktualisierungsintervall: 1 Stunde in Millisekunden
    let updateCount = 0; // Zähler für die Aktualisierungen

    const companiesByCountry = {
        DE: [
            { symbol: "DTE.DE", name: "Deutsche Telekom" },
            { symbol: "SIE.DE", name: "Siemens" },
            { symbol: "VOW3.DE", name: "Volkswagen" }
        ],
        US: [
            { symbol: "AAPL", name: "Apple" },
            { symbol: "MSFT", name: "Microsoft" },
            { symbol: "GOOGL", name: "Alphabet" }
        ],
        GB: [
            { symbol: "BP.L", name: "BP" },
            { symbol: "VOD.L", name: "Vodafone" },
            { symbol: "HSBA.L", name: "HSBC" }
        ],
        FR: [
            { symbol: "OR.PA", name: "L'Oréal" },
            { symbol: "AIR.PA", name: "Airbus" },
            { symbol: "BNP.PA", name: "BNP Paribas" }
        ]
    };

    let currentSymbol = 'DTE.DE';

    function updateCompanyList() {
        const country = document.getElementById('countrySelect').value;
        const stockSelect = document.getElementById('stockSelect');
        stockSelect.innerHTML = '';

        companiesByCountry[country].forEach(company => {
            const option = document.createElement('option');
            option.value = company.symbol;
            option.textContent = company.name;
            stockSelect.appendChild(option);
        });

        currentSymbol = stockSelect.value;
        updateStockData();
    }

    function updateStockData() {
        currentSymbol = document.getElementById('stockSelect').value;
        fetchLiveData();
        fetchHistoricalData();
    }

    async function fetchLiveData() {
        if (updateCount >= maxUpdatesPerDay) {
            console.log("Maximum number of updates reached for today.");
            return;
        }

        const url = `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${currentSymbol}&apikey=${apiKey}`;
        try {
            const response = await fetch(url);
            const result = await response.json();
            console.log("Live-Daten:", result);

            if (result['Global Quote'] && result['Global Quote']['05. price']) {
                const livePrice = result['Global Quote']['05. price'];
                document.getElementById('price').textContent = livePrice + ' €';
                updateCount++;
            } else {
                document.getElementById('price').textContent = 'Data not available';
            }
        } catch (error) {
            console.error("Error retrieving live data:", error);
            document.getElementById('price').textContent = 'Data not available';
        }
    }

    async function fetchHistoricalData() {
        const url = `https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${currentSymbol}&apikey=${apiKey}`;
        try {
            const response = await fetch(url);
            const result = await response.json();
            console.log("Historical data:", result);

            if (result['Time Series (Daily)']) {
                const prices = formatHistoricalData(result['Time Series (Daily)']);
                updateChart(prices);
            } else {
                document.getElementById('price').textContent = 'Data not available';
            }
        } catch (error) {
            console.error("Error retrieving historical data:", error);
            document.getElementById('price').textContent = 'Data not available';
        }
    }

    function updateChart(prices) {
    if (!prices || prices.length === 0) {
        prices = [
            { date: '2024-01-01', close: 100 },
            { date: '2024-01-02', close: 102 },
            { date: '2024-01-03', close: 104 },
            { date: '2024-01-04', close: 103 },
            { date: '2024-01-05', close: 105 },
            { date: '2024-01-06', close: 107 },
            { date: '2024-01-07', close: 106 },
            { date: '2024-01-08', close: 108 },
            { date: '2024-01-09', close: 110 },
            { date: '2024-01-10', close: 111 }
        ];
    }

    const labels = prices.map(entry => entry.date);
    const closePrices = prices.map(entry => entry.close);

    const ctx = document.getElementById('priceChart').getContext('2d');
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [{
                label: 'closing price in €',
                data: closePrices,
                borderColor: '#ff6600',
                backgroundColor: 'rgba(255, 102, 0, 0.2)',
                fill: true
            }]
        },
        options: {
            responsive: true,
            layout: {
                padding: {
                    left: 30,
                    right: 30,
                    top: 30,
                    bottom: 30 // Platz unten für die x-Achsenbeschriftungen
                }
            },
            scales: {
                x: {
                    ticks: {
                        font: {
                            size: 16,
                            family: 'Roboto'
                        },
                        color: 'rgba(255, 255, 255, 0.6)',
                        maxRotation: 45,
                        minRotation: 45
                    },
                    grid: {
                        display: true,
                        color: 'rgba(255, 255, 255, 0.2)'
                    }
                },
                y: {
                    ticks: {
                        font: {
                            size: 16,
                            family: 'Roboto'
                        },
                        color: 'rgba(255, 255, 255, 0.6)'
                    },
                    grid: {
                        display: true,
                        color: 'rgba(255, 255, 255, 0.2)'
                    }
                }
            },
            plugins: {
                legend: {
                    labels: {
                        font: {
                            size: 18,
                            family: 'Roboto'
                        },
                        color: 'rgba(255, 255, 255, 0.6)'
                    }
                },
                tooltip: {
                    titleColor: 'rgba(255, 255, 255, 0.6)',
                    bodyColor: 'rgba(255, 255, 255, 0.6)'
                }
            }
        }
    });
	}

	// Optional: Rufe updateChart ohne Daten auf, um die Testdaten zu laden
	updateChart();


    // Starte die automatische Aktualisierung der Live-Daten in festgelegten Intervallen
    setInterval(() => {
        const now = new Date();
        const hours = now.getHours();
        
        // Falls wir noch nicht 20 Updates haben und zwischen 9 und 17 Uhr sind
        if (updateCount < maxUpdatesPerDay && hours >= 9 && hours <= 17) {
            fetchLiveData();
        }
    }, updateInterval);

    updateCompanyList();
    </script>
</body>
</html>
